# AGENTS.md

This file gives AI agents (Cursor, Claude Code, OpenCode, etc.) consistent context when working in this repository.

## Project

**@everydaydevopsio/ballast** — CLI that installs TypeScript AI agent rules (linting, local-dev, CI/CD, observability, logging, testing) into the right places for Cursor, Claude Code, OpenCode, or Codex.

## Package manager

This project uses **pnpm**. Use `pnpm` for all install and run commands.

## Prerequisites

- **Node.js**: Use the version in `.nvmrc`. Run `nvm install` (or `nvm use`) after cloning so the correct Node version is active before `pnpm install`.

## Commands

```bash
pnpm install              # Install dependencies
pnpm run build            # Build (compile TypeScript to dist/)
pnpm test                 # Run tests
pnpm run test:coverage    # Run tests with coverage (80% threshold required)
pnpm run lint             # Check for linting errors
pnpm run lint:fix         # Auto-fix linting errors
pnpm run prettier         # Check formatting
pnpm run prettier:fix     # Auto-fix formatting
```

## Layout

- **`src/`** — TypeScript source: `cli.ts`, `install.ts`, `config.ts`, `agents.ts`, `build.ts`; tests live alongside as `*.test.ts`.
- **`bin/ballast.js`** — Shebang entry that runs the compiled CLI (`dist/cli.js`).
- **`agents/`** — Agent content and per-target templates (e.g. `agents/linting/content.md`, `agents/linting/templates/`).
- **`docs/`** — User-facing docs: `docs/README.md` (agent table), `docs/agents/<id>.md` (one guide per agent), `docs/installation.md`.
- **`dist/`** — Compiled output (generated by `pnpm run build`); do not edit.

## Conventions

- **Package manager**: Use pnpm (not npm or yarn).
- **Badges**: README badges (CI, Lint, Release, License, GitHub Release, npm) follow the local-dev-badges rule.
- **Single overwrite policy**: do not overwrite existing rule files unless the user passes `--force`.
- **Platform first, then agents**: user can choose "all" agents.
- **Config**: `.rulesrc.json` stores `target` and `agents` so repeat runs can be non-interactive.
- **CI**: When `CI=true` or `--yes` is set and `.rulesrc.json` is missing, `--target` and `--agent` (or `--all`) are required.
- **Agents**: Only agents shipped in this repo are installable (no external bundle discovery).
- **Docs sync**: When you add or update an agent, update the docs in `docs/` so they stay in sync: add or update `docs/agents/<id>.md` for that agent, and update the agent table in `docs/README.md` (and any other references, e.g. `docs/installation.md` if needed).

## License

Default license for this project: **MIT**. If you add or modify license setup (LICENSE file, `package.json` license, README reference), use MIT unless this section specifies otherwise. To override, replace MIT with another SPDX identifier (e.g. Apache-2.0, ISC, BSD-3-Clause).

## Working here

- Prefer TypeScript for all new code in `src/`.
- Keep tests next to source (`*.test.ts`); use Jest.
- Run `pnpm run build` before relying on `bin/ballast` or `dist/`.
- When adding or updating an agent: update `docs/agents/<id>.md` and the agent table in `docs/README.md` so docs stay in sync (see **Docs sync** under Conventions).
- See **CLAUDE.md** for more detailed architecture and **rules-installer-architecture.md** for design notes.
